var J=Object.defineProperty;var K=(m,u,n)=>u in m?J(m,u,{enumerable:!0,configurable:!0,writable:!0,value:n}):m[u]=n;var i=(m,u,n)=>K(m,typeof u!="symbol"?u+"":u,n);import{b,V as D,_ as W}from"./VDataTable-CCJl_ig7.js";import{e as X,r as v,L as w,c as Y,C as Z,f as y,i as h,w as d,d as a,O as N,P as _,j as f,l as t,D as ee,h as A,Q as I,t as B,V as g,N as le}from"./index-DOiLiAGW.js";import{u as te}from"./DivisionsStore-C6cQWFB7.js";import{u as ae,V as F,a as se}from"./StudentsStore-jqVVSawU.js";import{V}from"./VTextField-DeKW-4cg.js";import"./VOverlay-A_z2X8Te.js";import"./forwardRefs-cf9lWiri.js";import"./transition-PVbPGmxI.js";import"./VImg-CgLEQQ14.js";class L{constructor(){i(this,"name");i(this,"class");i(this,"dadName");i(this,"momName");i(this,"area");i(this,"dadNumber");i(this,"momNumber");i(this,"division");i(this,"driver")}}class G{constructor(){i(this,"familyName");i(this,"studentIds")}}const oe={class:"w-full"},de={key:0,class:"grid grid-cols-2 gap-4 p-5 md:grid-cols-3"},ne={key:1,class:"p-5 flex gap-4"},ie={class:"flex gap-2 flex-row-reverse"},ue={class:"flex flex-col gap-3"},me={class:"d-flex gap-1 justify-center"},re={class:"d-flex gap-1 justify-center"},Ce=X({__name:"students",setup(m){const u=v(null),n=ae(),C=te(),{studentsList:k,familiesList:j,studentsNamesList:P}=w(n),{classesList:x}=w(C);(()=>{le().SetPageMeta({breadCrumb:[],icon:"ri-home-smile-line",title:"الطلاب"}),n.GetAllStudents(),n.GetAllFamilies()})();const R=()=>{var o;(o=u.value)==null||o.closeDialog(),s.value=new L,p.value=new G},s=v(new L),p=v(new G),T=()=>{n.AddStudent(s.value).then(()=>{})},$=()=>{n.AddFamily(p.value)},E=Y(()=>{var o;return((o=x.value.find(l=>l._id===s.value.class))==null?void 0:o.divisionsIds)||[]}),M=[{title:"اسم الطالب",value:"name"},{title:"الصف",value:"class.name"},{title:"تفاصيل",value:"actions",align:"center"}],O=[{title:"اسم العائلة",value:"familyName"},{title:"الطلاب",value:"students"},{title:"تفاصيل",value:"actions",align:"center"}],Q=()=>{var o;n.GetStudentsNames(),C.GetAllClasses(),(o=u.value)==null||o.openDialog()},r=v("student"),q=o=>{n.DeleteStudent(o)},z=o=>{n.DeleteFamily(o)},U=v([...k.value]),H=o=>{U.value=k.value.filter(l=>l.name.includes(o))};return(o,l)=>{const c=Z("IconBtn");return y(),h(W,{ref_key:"StudentsPage",ref:u,icon:"tabler-user","button-text":"إضافة جديد","dialog-title":"إضافة جديد","onUpdate:search":H},{"action-button":d(()=>[a(_,{onClick:Q},{default:d(()=>l[13]||(l[13]=[N("إضافة")])),_:1})]),"dialog-form":d(()=>[f("div",oe,[a(se,{modelValue:t(r),"onUpdate:modelValue":l[0]||(l[0]=e=>ee(r)?r.value=e:null)},{default:d(()=>[a(F,{value:"student",label:"طالب"}),a(F,{value:"family",label:"عائلة"})]),_:1},8,["modelValue"]),t(r)==="student"?(y(),A("div",de,[a(V,{modelValue:t(s).name,"onUpdate:modelValue":l[1]||(l[1]=e=>t(s).name=e),label:"* اسم الطالب",rules:[e=>!!e||"اسم الطالب مطلوب"]},null,8,["modelValue","rules"]),a(b,{modelValue:t(s).class,"onUpdate:modelValue":l[2]||(l[2]=e=>t(s).class=e),label:"*الصف",items:t(x),"item-value":"_id","item-title":"name",rules:[e=>!!e||"اسم الطالب مطلوب"]},null,8,["modelValue","items","rules"]),a(b,{modelValue:t(s).division,"onUpdate:modelValue":l[3]||(l[3]=e=>t(s).division=e),items:t(E),"item-value":"_id","item-title":"name",label:"*الشعبة",rules:[e=>!!e||"اسم الطالب مطلوب"]},null,8,["modelValue","items","rules"]),a(V,{modelValue:t(s).dadName,"onUpdate:modelValue":l[4]||(l[4]=e=>t(s).dadName=e),label:"اسم الأب"},null,8,["modelValue"]),a(V,{modelValue:t(s).momName,"onUpdate:modelValue":l[5]||(l[5]=e=>t(s).momName=e),label:"اسم الأم"},null,8,["modelValue"]),a(V,{modelValue:t(s).area,"onUpdate:modelValue":l[6]||(l[6]=e=>t(s).area=e),label:"المنطقة"},null,8,["modelValue"]),a(V,{modelValue:t(s).dadNumber,"onUpdate:modelValue":l[7]||(l[7]=e=>t(s).dadNumber=e),label:"رقم الأب"},null,8,["modelValue"]),a(V,{modelValue:t(s).momNumber,"onUpdate:modelValue":l[8]||(l[8]=e=>t(s).momNumber=e),label:"رقم الأم"},null,8,["modelValue"]),a(b,{modelValue:t(s).driver,"onUpdate:modelValue":l[9]||(l[9]=e=>t(s).driver=e),"item-value":"_id","item-title":"name",label:"السائق"},null,8,["modelValue"])])):I("",!0),t(r)==="family"?(y(),A("div",ne,[a(V,{label:"اسم العائلة",modelValue:t(p).familyName,"onUpdate:modelValue":l[10]||(l[10]=e=>t(p).familyName=e)},null,8,["modelValue"]),a(b,{label:"الطلاب",modelValue:t(p).studentIds,"onUpdate:modelValue":l[11]||(l[11]=e=>t(p).studentIds=e),items:t(P),"item-value":"_id","item-title":"name",multiple:""},null,8,["modelValue","items"])])):I("",!0),f("div",ie,[a(_,{onClick:l[12]||(l[12]=e=>t(r)==="student"?T():$())},{default:d(()=>[N(B(t(r)==="student"?"إضافة طالب":"إضافة عائلة"),1)]),_:1}),a(_,{onClick:R,variant:"outlined"},{default:d(()=>l[14]||(l[14]=[N("رجوع")])),_:1})])])]),default:d(()=>[f("div",ue,[a(D,{headers:M,items:t(U)},{"item.actions":d(({item:e})=>[f("div",me,[a(c,{onClick:S=>q(e._id)},{default:d(()=>[a(g,{color:"error",icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"]),a(c,null,{default:d(()=>[a(g,{icon:"ri-edit-line"})]),_:1})])]),_:1},8,["headers","items"]),a(D,{headers:O,items:t(j)},{"item.actions":d(({item:e})=>[f("div",re,[a(c,{onClick:S=>z(e._id)},{default:d(()=>[a(g,{color:"error",icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"]),a(c,null,{default:d(()=>[a(g,{icon:"ri-edit-line "})]),_:1})])]),"item.students":d(({item:e})=>[N(B(e.students.map(S=>S.name).join(", ")),1)]),_:1},8,["headers","items"])])]),_:1},512)}}});export{Ce as default};
