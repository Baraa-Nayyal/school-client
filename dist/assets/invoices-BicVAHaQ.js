import{b as _,V as M,_ as T}from"./VDataTable-CCJl_ig7.js";import{e as $,r as d,M as h,L as P,C as j,f,i as p,w as n,d as l,O as v,P as V,l as t,D as F,j as b,V as S,N as O}from"./index-DOiLiAGW.js";import{u as q,V as k,a as z}from"./StudentsStore-jqVVSawU.js";import{u as E,a as C}from"./dto-CIjScN1s.js";import{V as y}from"./VTextField-DeKW-4cg.js";import"./VOverlay-A_z2X8Te.js";import"./forwardRefs-cf9lWiri.js";import"./transition-PVbPGmxI.js";import"./VImg-CgLEQQ14.js";const H={class:"flex gap-4 p-5"},J={class:"flex gap-3"},K={class:"d-flex gap-1 justify-center"},se=$({__name:"invoices",setup(Q){const m=d(null),x=h(),i=E(),c=q(),{studentsNamesList:A,familiesNamesList:L}=P(c),s=d(new C),{invoicesList:u}=P(i),N=()=>{O().SetPageMeta({breadCrumb:[],icon:"ri-home-smile-line",title:"الأقساط"}),i.GetInvoices().then(()=>{u.value=u.value.map(o=>({...o,schoolPrice:o.schoolPrice.toLocaleString(),busPrice:o.busPrice.toLocaleString(),totalAmount:o.totalAmount.toLocaleString(),remainingAmount:o.remainingAmount.toLocaleString()}))})},D=()=>{var o;c.GetStudentsNames(),c.GetFamiliesNames(),(o=m.value)==null||o.openDialog()};N();const w=()=>{var o;s.value=new C,(o=m.value)==null||o.closeDialog()},B=()=>{i.AddInvoice(s.value)},U=[{title:"الاسم",value:"name"},{title:"قسط المدرسة",value:"schoolPrice"},{title:"قسط الأوتوكار",value:"busPrice"},{title:"الإجمالي",value:"totalAmount"},{title:"المتبقي",value:"remainingAmount"},{title:"التفاصيل",value:"actions",align:"center"}],r=d("student"),g=d([...u.value]),R=o=>{g.value=u.value.filter(e=>e.studentId.name.includes(o))};return(o,e)=>{const I=j("IconBtn");return f(),p(T,{ref_key:"InvoicesPage",ref:m,icon:"tabler-user","button-text":"إضافة قسط","dialog-title":"قسط جديد","onUpdate:search":R},{"action-button":n(()=>[l(V,{onClick:D},{default:n(()=>e[5]||(e[5]=[v("إضافة")])),_:1})]),"dialog-form":n(()=>[l(z,{inline:"",modelValue:t(r),"onUpdate:modelValue":e[0]||(e[0]=a=>F(r)?r.value=a:null),class:"mb-4"},{default:n(()=>[l(k,{value:"student",label:"قسط طالب "}),l(k,{value:"family",label:"قسط عائلة"})]),_:1},8,["modelValue"]),b("div",H,[t(r)==="student"?(f(),p(_,{key:0,label:"اسم الطالب",class:"w-1/2",modelValue:t(s).studentId,"onUpdate:modelValue":e[1]||(e[1]=a=>t(s).studentId=a),items:t(A),"item-title":"name","item-value":"_id"},null,8,["modelValue","items"])):(f(),p(_,{key:1,label:"اسم العائلة",modelValue:t(s).familyId,"onUpdate:modelValue":e[2]||(e[2]=a=>t(s).familyId=a),class:"w-1/2",items:t(L),"item-title":"familyName","item-value":"_id"},null,8,["modelValue","items"])),l(y,{label:"قسط الأوتوكار",type:"number",modelValue:t(s).busPrice,"onUpdate:modelValue":e[3]||(e[3]=a=>t(s).busPrice=a),modelModifiers:{number:!0}},null,8,["modelValue"]),l(y,{label:"قسط المدرسة",type:"number",modelValue:t(s).schoolPrice,"onUpdate:modelValue":e[4]||(e[4]=a=>t(s).schoolPrice=a),modelModifiers:{number:!0}},null,8,["modelValue"])]),b("div",J,[l(V,{onClick:B},{default:n(()=>e[6]||(e[6]=[v("إضافة")])),_:1}),l(V,{onClick:w,variant:"outlined"},{default:n(()=>e[7]||(e[7]=[v("رجوع")])),_:1})])]),default:n(()=>[l(M,{headers:U,items:t(g)},{"item.actions":n(({item:a})=>[b("div",K,[l(I,{onClick:G=>t(x).push(`invoices/${a._id}`)},{default:n(()=>[l(S,{icon:"ri-home-smile-line"})]),_:2},1032,["onClick"]),l(I,{onClick:G=>t(i).DeleteInvoice(a._id)},{default:n(()=>[l(S,{color:"error",icon:"ri-delete-bin-line"})]),_:2},1032,["onClick"])])]),_:1},8,["headers","items"])]),_:1},512)}}});export{se as default};
